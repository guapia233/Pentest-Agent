import autogen
import sys
sys.path.append("/home/kali/Agent/Agent-main-master/")
sys.path.append("/home/kali/Agent/Agent-main-master/config")
sys.path.append("/home/kali/Agent/Agent-main-master/contant")
from typing import Type
from langchain_community.vectorstores.elasticsearch import ElasticsearchStore
from langchain_core.tools import BaseTool
from pydantic import BaseModel, Field
from contant.ESContant import es_url, index_name, embeddings


class QueryInput(BaseModel):
    query: str = Field()


class retrieve(BaseTool):
    name = "retrieve"
    description = "使用ES进行检索"
    args_schema: Type[BaseModel] = QueryInput

    def _run(self, query: str):
        result = ""
        # 开启ES客户端
        vectorstore = ElasticsearchStore(
            es_url=es_url, index_name=index_name, embedding=embeddings
        )
        result = vectorstore.similarity_search(query, k=1)

        return f"获得检索到的信息 {result}"


if __name__ == '__main__':
    # Example usage
    result = retrieve()
    query="怎么通过漏洞，实现控制靶机"
    run = result._run(query= query)
    print(run)
