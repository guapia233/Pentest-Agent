import os
import openai
from dotenv import load_dotenv, find_dotenv
from langchain.agents import AgentExecutor, initialize_agent, AgentType
from langchain.memory import ConversationBufferMemory
from langchain_community.llms.openai import OpenAI

from agent.prompt import template, templat_English
from contant.LinuxContant import LHOST, username, password
from tool import tools
from tool.LinuxConnect import LinuxConnect

_ = load_dotenv(find_dotenv())  # read local .env file
openai.api_key = os.environ['OPENAI_API_KEY']


llm=OpenAI(temperature=0)

agent = initialize_agent(
    tools, llm, agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION, verbose=True
)
# agent_executor.invoke({"input": "当目标靶机IP未知时，我要进行渗透测试，攻击在网段是192.168.60.0/24的一台电脑，请执行操作，当工具无法回答的时候，提醒用户并返回最后的结果"})['output']

# 从控制台获取输入
user_input = input("请输入你的输入内容：")
# 将用户输入传递给 agent_executor.invoke() 函数，并处理解析错误
#那我把connect写在这个地方
connect = LinuxConnect(LHOST, username, password)
result = agent.run(user_input)

